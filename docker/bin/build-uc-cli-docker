#!/usr/bin/env bash
set -ex;

current_dir=$(pwd)
script_dir=$(dirname $0)
docker_dir=$(dirname $(dirname $(realpath $script_dir)))
docker_file="uc-cli.dockerfile"
container_version="0.1.0"
container_name="unitycatalog-cli"

echo "Changing directory to $docker_dir"
cd $docker_dir

if [[ -r "$docker_file" ]]; then
    ls -al
    echo "Building container $container_name:$container_version from Dockerfile $docker_file"
    docker buildx build --progress=plain -t "$container_name:$container_version" -f "$docker_file" .
else
    echo "Dockerfile not found."
    exit
fi

echo "Returning to base directory $current_dir"
cd $current_dir